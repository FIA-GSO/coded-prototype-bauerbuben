<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Berichtsheft</title>
    <style>
        * { box-sizing: border-box; }
        
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        /* Login Styles */
        #login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f5f5f5;
        }
        
        #login-box {
            background-color: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
        }
        
        #login-box h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 32px;
        }
        
        .login-form-group {
            margin-bottom: 20px;
        }
        
        .login-form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        
        .login-form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .login-form-group input:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        #login-btn {
            width: 100%;
            padding: 12px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        #login-btn:hover {
            background-color: #45a049;
        }
        
        .role-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .role-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #ccc;
            background-color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .role-btn.active {
            background-color: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }
        
        #app-container {
            display: none;
        }
        
        /* Kommentar Styles */
        .kommentar-section {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
        }
        
        .kommentar-header {
            font-size: 12px;
            font-weight: bold;
            color: #666;
            margin-bottom: 5px;
        }
        
        .kommentar-text {
            font-size: 13px;
            color: #555;
            font-style: italic;
            background-color: #fff9e6;
            padding: 8px;
            border-radius: 5px;
            margin-bottom: 5px;
        }
        
        .kommentar-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 12px;
            margin-top: 5px;
            resize: vertical;
            min-height: 40px;
        }
        
        .kommentar-btn {
            background-color: #2196F3;
            color: white;
            padding: 5px 10px;
            font-size: 11px;
            margin-top: 5px;
            width: 100%;
        }
        
        .kommentar-btn:hover {
            background-color: #0b7dda;
        }
        
        .ausbilder-mode {
            background-color: #e3f2fd;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 10px;
            font-weight: bold;
            color: #1976D2;
        }
        
        header {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        header h1 {
            margin: 0 0 15px 0;
            font-size: 36px;
        }
        
        .datum-bereich {
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }
        
        .datum-input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            background-color: white;
        }
        
        .datum-input:hover {
            border-color: #4CAF50;
        }
        
        .week-nav-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }
        
        .week-nav-btn:hover {
            background-color: #45a049;
        }
        
        .calendar-icon {
            width: 16px;
            height: 16px;
            background-color: #ddd;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .calendar-icon:hover {
            background-color: #4CAF50;
        }
        
        /* Kalender Popup */
        .calendar-popup {
            position: absolute;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            padding: 20px;
            z-index: 1000;
            display: none;
            margin-top: 5px;
        }
        
        .calendar-popup.active {
            display: block;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .calendar-nav-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .calendar-nav-btn:hover {
            background-color: #45a049;
        }
        
        .calendar-month-year {
            font-weight: bold;
            font-size: 16px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 10px;
        }
        
        .calendar-day-header {
            text-align: center;
            font-weight: bold;
            font-size: 12px;
            color: #666;
            padding: 5px;
        }
        
        .calendar-day {
            text-align: center;
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .calendar-day:hover {
            background-color: #e8f5e9;
        }
        
        .calendar-day.other-month {
            color: #ccc;
        }
        
        .calendar-day.selected {
            background-color: #4CAF50;
            color: white;
        }
        
        .calendar-day.in-range {
            background-color: #c8e6c9;
        }
        
        .calendar-close-btn {
            width: 100%;
            margin-top: 15px;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px;
            cursor: pointer;
        }
        
        .calendar-close-btn:hover {
            background-color: #0b7dda;
        }
        
        main {
            display: flex;
            gap: 20px;
        }
        
        section {
            background-color: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            height: 60%;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .tag-header {
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .eintraege-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            flex: 1;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .eintraege-container::-webkit-scrollbar { width: 6px; }
        .eintraege-container::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .eintraege-container::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
        .eintraege-container::-webkit-scrollbar-thumb:hover { background: #555; }
        
        article {
            background-color: #f8f8f8;
            border-radius: 10px;
            padding: 15px;
            min-height: 80px;
            border: 1px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        article:hover {
            background-color: #f0f0f0;
            border-color: #ccc;
        }
        
        article.selected {
            background-color: #e3f2fd;
            border-color: #2196F3;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
        }
        
        textarea {
            width: 100%;
            height: 60px;
            border: none;
            background: transparent;
            resize: none;
            font-size: 14px;
            color: #999;
            font-family: Arial, sans-serif;
        }
        
        textarea:focus {
            outline: none;
            color: #333;
        }
        
        button {
            border: none;
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }
        
        .add-entry-btn {
            background-color: #4CAF50;
            color: white;
            margin-top: 10px;
        }
        
        .add-entry-btn:hover {
            background-color: #45a049;
        }
        
        .delete-entry-btn {
            background-color: #f44336;
            color: white;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 11px;
            margin-top: 5px;
            width: 100%;
        }
        
        .delete-entry-btn:hover {
            background-color: #da190b;
        }
        
        @media (max-width: 768px) {
            body { padding: 10px; background-color: #f0f0f0; }
            
            #login-box {
                padding: 30px 20px;
                border-radius: 25px;
            }
            
            #login-box h1 { font-size: 24px; }
            
            .calendar-popup {
                position: fixed;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
                max-width: 90%;
            }
            
            .calendar-grid {
                font-size: 12px;
            }
            
            .calendar-day {
                padding: 6px;
            }
            
            header { border-radius: 25px; padding: 15px; }
            header h1 { font-size: 24px; text-align: center; }
            .datum-bereich { justify-content: center; }
            .week-nav-btn { 
                padding: 6px 8px; 
                font-size: 12px;
                border-radius: 10px;
            }
            .datum-input { background-color: #d0d0d0; border: none; border-radius: 15px; padding: 8px 16px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); }
            main { flex-direction: column; gap: 15px; }
            section { height: auto; background-color: #e8e8e8; border-radius: 25px; }
            .tag-header { font-size: 18px; justify-content: center; cursor: pointer; padding: 10px; background-color: rgba(255, 255, 255, 0.3); border-radius: 15px; margin-bottom: 0; }
            .tag-header::after { content: " ▼"; float: right; }
            section.expanded .tag-header::after { content: " ▲"; }
            .calendar-icon { display: none; }
            .eintraege-container { display: none; margin-top: 15px; overflow-y: visible; gap: 10px; }
            section.expanded .eintraege-container { display: flex; }
            article { background-color: white; border-radius: 15px; padding: 12px; min-height: 60px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); }
            textarea { height: 40px; }
            .add-entry-btn { display: none; border-radius: 25px; padding: 12px; font-size: 15px; margin-top: 15px; }
            section.expanded .add-entry-btn { display: block; }
            .delete-entry-btn { border-radius: 10px; padding: 8px; font-size: 12px; }
            .kommentar-btn { border-radius: 10px; padding: 8px; font-size: 12px; }
        }
        
        @media (max-width: 480px) {
            body { padding: 5px; }
            header { padding: 12px; }
            header h1 { font-size: 20px; }
            section { padding: 12px; }
            article { padding: 10px; }
            textarea { height: 35px; font-size: 13px; }
        }
    </style>
</head>
<body>
    <!-- Login Container -->
    <div id="login-container">
        <div id="login-box">
            <h1>Berichtsheft Login</h1>
            <div class="role-selector">
                <button class="role-btn active" data-role="azubi">Azubi</button>
                <button class="role-btn" data-role="ausbilder">Ausbilder</button>
            </div>
            <form id="login-form">
                <div class="login-form-group">
                    <label for="username">Benutzername</label>
                    <input type="text" id="username" required>
                </div>
                <div class="login-form-group">
                    <label for="password">Passwort</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" id="login-btn">Anmelden</button>
            </form>
        </div>
    </div>
    
    <!-- App Container -->
    <div id="app-container">
        <div id="role-indicator"></div>
        <header>
            <h1>Berichtsheft</h1>
            <div class="datum-bereich">
                <button class="week-nav-btn" id="prev-week">◀</button>
                <input type="text" class="datum-input" id="start-datum" value="19.09" readonly>
                <span>-</span>
                <input type="text" class="datum-input" id="end-datum" value="26.09" readonly>
                <button class="week-nav-btn" id="next-week">▶</button>
                <div class="calendar-icon" id="calendar-toggle"></div>
                <div class="calendar-popup" id="calendar-popup">
                    <div class="calendar-header">
                        <button class="calendar-nav-btn" id="prev-month">◀</button>
                        <div class="calendar-month-year" id="month-year"></div>
                        <button class="calendar-nav-btn" id="next-month">▶</button>
                    </div>
                    <div class="calendar-grid" id="calendar-grid"></div>
                    <button class="calendar-close-btn" id="calendar-close">Schließen</button>
                </div>
            </div>
        </header>
        
        <main id="tage-container"></main>
    </div>
    
    <script>
        const TAGE = ['Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag'];
        let currentRole = 'azubi'; // 'azubi' oder 'ausbilder'
        
        // Kalender Variablen
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let selectedStartDate = null;
        let selectedEndDate = null;
        let isSelectingStart = true;
        
        // Wochenverwaltung
        let currentWeekStart = new Date();
        currentWeekStart.setDate(currentWeekStart.getDate() - currentWeekStart.getDay() + 1); // Montag
        
        const monthNames = ['Januar', 'Februar', 'März', 'April', 'Mai', 'Juni',
                           'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'];
        const dayNames = ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'];
        
        // Login Funktionalität
        document.addEventListener('DOMContentLoaded', () => {
            // Role Selector
            document.querySelectorAll('.role-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                });
            });
            
            // Login Form
            document.getElementById('login-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const selectedRole = document.querySelector('.role-btn.active').dataset.role;
                
                // Pseudo-Login: Jede Eingabe ist gültig
                if (username && password) {
                    currentRole = selectedRole;
                    document.getElementById('login-container').style.display = 'none';
                    document.getElementById('app-container').style.display = 'block';
                    
                    // Zeige Rolle an
                    if (currentRole === 'ausbilder') {
                        document.getElementById('role-indicator').innerHTML = 
                            '<div class="ausbilder-mode">Ausbilder-Modus aktiv</div>';
                    }
                    
                    initWeekNavigation();
                    initCalendar();
                    updateWeekDisplay();
                    init();
                }
            });
        });
        
        // Wochennavigation
        function initWeekNavigation() {
            document.getElementById('prev-week').addEventListener('click', () => {
                currentWeekStart.setDate(currentWeekStart.getDate() - 7);
                updateWeekDisplay();
                resetEntries(); // Einträge zurücksetzen
            });
            
            document.getElementById('next-week').addEventListener('click', () => {
                currentWeekStart.setDate(currentWeekStart.getDate() + 7);
                updateWeekDisplay();
                resetEntries(); // Einträge zurücksetzen
            });
        }
        
        function updateWeekDisplay() {
            const weekEnd = new Date(currentWeekStart);
            weekEnd.setDate(weekEnd.getDate() + 4); // Freitag (5 Tage Woche)
            
            document.getElementById('start-datum').value = formatDate(currentWeekStart);
            document.getElementById('end-datum').value = formatDate(weekEnd);
        }
        
        function resetEntries() {
            // Container leeren und neu initialisieren
            const container = document.getElementById('tage-container');
            container.innerHTML = '';
            TAGE.forEach(tag => container.appendChild(createDaySection(tag)));
        }
        
        // Kalender Funktionalität
        function initCalendar() {
            const calendarToggle = document.getElementById('calendar-toggle');
            const calendarPopup = document.getElementById('calendar-popup');
            const calendarClose = document.getElementById('calendar-close');
            const prevMonth = document.getElementById('prev-month');
            const nextMonth = document.getElementById('next-month');
            
            calendarToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                calendarPopup.classList.toggle('active');
                if (calendarPopup.classList.contains('active')) {
                    renderCalendar();
                }
            });
            
            calendarClose.addEventListener('click', () => {
                calendarPopup.classList.remove('active');
            });
            
            prevMonth.addEventListener('click', () => {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                renderCalendar();
            });
            
            nextMonth.addEventListener('click', () => {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                renderCalendar();
            });
            
            // Schließen wenn außerhalb geklickt wird
            document.addEventListener('click', (e) => {
                if (!calendarPopup.contains(e.target) && e.target !== calendarToggle) {
                    calendarPopup.classList.remove('active');
                }
            });
        }
        
        function renderCalendar() {
            const monthYear = document.getElementById('month-year');
            const calendarGrid = document.getElementById('calendar-grid');
            
            monthYear.textContent = `${monthNames[currentMonth]} ${currentYear}`;
            
            // Clear grid
            calendarGrid.innerHTML = '';
            
            // Add day headers
            dayNames.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                calendarGrid.appendChild(header);
            });
            
            // Get first day of month and number of days
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const prevMonthDays = new Date(currentYear, currentMonth, 0).getDate();
            
            // Add previous month's days
            for (let i = firstDay - 1; i >= 0; i--) {
                const day = document.createElement('div');
                day.className = 'calendar-day other-month';
                day.textContent = prevMonthDays - i;
                calendarGrid.appendChild(day);
            }
            
            // Add current month's days
            for (let i = 1; i <= daysInMonth; i++) {
                const day = document.createElement('div');
                day.className = 'calendar-day';
                day.textContent = i;
                
                const currentDate = new Date(currentYear, currentMonth, i);
                
                // Check if selected
                if (selectedStartDate && isSameDay(currentDate, selectedStartDate)) {
                    day.classList.add('selected');
                }
                if (selectedEndDate && isSameDay(currentDate, selectedEndDate)) {
                    day.classList.add('selected');
                }
                
                // Check if in range
                if (selectedStartDate && selectedEndDate && 
                    currentDate > selectedStartDate && currentDate < selectedEndDate) {
                    day.classList.add('in-range');
                }
                
                day.addEventListener('click', () => selectDate(currentDate));
                calendarGrid.appendChild(day);
            }
            
            // Add next month's days
            const totalCells = calendarGrid.children.length - 7; // minus headers
            const remainingCells = 42 - totalCells - 7; // 6 rows * 7 days - existing - headers
            for (let i = 1; i <= remainingCells; i++) {
                const day = document.createElement('div');
                day.className = 'calendar-day other-month';
                day.textContent = i;
                calendarGrid.appendChild(day);
            }
        }
        
        function selectDate(date) {
            if (isSelectingStart || !selectedStartDate) {
                selectedStartDate = date;
                selectedEndDate = null;
                isSelectingStart = false;
            } else {
                if (date < selectedStartDate) {
                    selectedEndDate = selectedStartDate;
                    selectedStartDate = date;
                } else {
                    selectedEndDate = date;
                }
                
                // Berechne den Montag der ausgewählten Woche
                const weekStart = new Date(selectedStartDate);
                const day = weekStart.getDay();
                const diff = day === 0 ? -6 : 1 - day; // Wenn Sonntag, gehe 6 Tage zurück, sonst zum Montag
                weekStart.setDate(weekStart.getDate() + diff);
                
                currentWeekStart = weekStart;
                updateWeekDisplay();
                resetEntries(); // Einträge zurücksetzen
                
                isSelectingStart = true;
                document.getElementById('calendar-popup').classList.remove('active');
            }
            renderCalendar();
        }
        
        function updateDateInputs() {
            if (selectedStartDate) {
                document.getElementById('start-datum').value = formatDate(selectedStartDate);
            }
            if (selectedEndDate) {
                document.getElementById('end-datum').value = formatDate(selectedEndDate);
            }
        }
        
        function formatDate(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            return `${day}.${month}`;
        }
        
        function isSameDay(date1, date2) {
            return date1.getDate() === date2.getDate() &&
                   date1.getMonth() === date2.getMonth() &&
                   date1.getFullYear() === date2.getFullYear();
        }
        
        function init() {
            const container = document.getElementById('tage-container');
            container.innerHTML = ''; // Clear previous content
            TAGE.forEach(tag => container.appendChild(createDaySection(tag)));
        }
        
        function createDaySection(tag) {
            const section = document.createElement('section');
            section.dataset.day = tag.toLowerCase();
            section.innerHTML = `
                <div class="tag-header"><div class="calendar-icon"></div>${tag}</div>
                <div class="eintraege-container">${createEntryHTML()}</div>
                <button class="add-entry-btn">+ Neuer Eintrag</button>
            `;
            
            section.querySelector('.add-entry-btn').addEventListener('click', () => addEntry(section));
            section.querySelector('.tag-header').addEventListener('click', () => {
                if (window.innerWidth <= 768) section.classList.toggle('expanded');
            });
            section.querySelector('article').addEventListener('click', (e) => {
                if (e.target.tagName !== 'BUTTON' && e.target.tagName !== 'TEXTAREA') selectEntry(e.currentTarget);
            });
            section.querySelector('.delete-entry-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                deleteEntry(e.target.closest('article'));
            });
            
            // Kommentar-Button Event Listener
            const kommentarBtn = section.querySelector('.kommentar-btn');
            if (kommentarBtn) {
                kommentarBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    addKommentar(e.target.closest('article'));
                });
            }
            
            return section;
        }
        
        function createEntryHTML() {
            const kommentarSection = currentRole === 'ausbilder' ? `
                <div class="kommentar-section">
                    <div class="kommentar-header">Ausbilder-Kommentar:</div>
                    <div class="kommentar-text" style="display: none;"></div>
                    <textarea class="kommentar-input" placeholder="Kommentar hinzufügen..."></textarea>
                    <button class="kommentar-btn button">Kommentar speichern</button>
                </div>
            ` : `
                <div class="kommentar-section" style="display: none;">
                    <div class="kommentar-header">Ausbilder-Kommentar:</div>
                    <div class="kommentar-text"></div>
                </div>
            `;
            
            return `<article>
                <textarea placeholder="Hier eintragen..."></textarea>
                ${kommentarSection}
                <button class="delete-entry-btn">Löschen</button>
            </article>`;
        }
        
        function addEntry(section) {
            const container = section.querySelector('.eintraege-container');
            const article = document.createElement('article');
            
            const kommentarSection = currentRole === 'ausbilder' ? `
                <div class="kommentar-section">
                    <div class="kommentar-header">Ausbilder-Kommentar:</div>
                    <div class="kommentar-text" style="display: none;"></div>
                    <textarea class="kommentar-input" placeholder="Kommentar hinzufügen..."></textarea>
                    <button class="kommentar-btn button">Kommentar speichern</button>
                </div>
            ` : `
                <div class="kommentar-section" style="display: none;">
                    <div class="kommentar-header">Ausbilder-Kommentar:</div>
                    <div class="kommentar-text"></div>
                </div>
            `;
            
            article.innerHTML = `
                <textarea placeholder="Hier eintragen..."></textarea>
                ${kommentarSection}
                <button class="delete-entry-btn">Löschen</button>
            `;
            
            article.addEventListener('click', (e) => {
                if (e.target.tagName !== 'BUTTON' && e.target.tagName !== 'TEXTAREA') selectEntry(article);
            });
            article.querySelector('.delete-entry-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                deleteEntry(article);
            });
            
            // Kommentar-Button Event Listener
            const kommentarBtn = article.querySelector('.kommentar-btn');
            if (kommentarBtn) {
                kommentarBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    addKommentar(article);
                });
            }
            
            container.appendChild(article);
        }
        
        function selectEntry(article) {
            document.querySelectorAll('article').forEach(a => a.classList.remove('selected'));
            article.classList.add('selected');
            
            // Zeige Kommentare für Azubis an
            if (currentRole === 'azubi') {
                const kommentarSection = article.querySelector('.kommentar-section');
                const kommentarText = article.querySelector('.kommentar-text');
                if (kommentarText && kommentarText.textContent.trim()) {
                    kommentarSection.style.display = 'block';
                }
            }
        }
        
        function deleteEntry(article) {
            const container = article.closest('.eintraege-container');
            if (container.children.length <= 1) {
                alert('Mindestens ein Eintrag muss vorhanden bleiben.');
                return;
            }
            article.remove();
        }
        
        function addKommentar(article) {
            const kommentarInput = article.querySelector('.kommentar-input');
            const kommentarText = article.querySelector('.kommentar-text');
            
            if (kommentarInput && kommentarInput.value.trim()) {
                kommentarText.textContent = kommentarInput.value;
                kommentarText.style.display = 'block';
                kommentarInput.value = '';
                kommentarInput.style.display = 'none';
                article.querySelector('.kommentar-btn').textContent = 'Kommentar bearbeiten';
                article.querySelector('.kommentar-btn').onclick = (e) => {
                    e.stopPropagation();
                    editKommentar(article);
                };
            }
        }
        
        function editKommentar(article) {
            const kommentarInput = article.querySelector('.kommentar-input');
            const kommentarText = article.querySelector('.kommentar-text');
            
            kommentarInput.value = kommentarText.textContent;
            kommentarInput.style.display = 'block';
            article.querySelector('.kommentar-btn').textContent = 'Kommentar speichern';
            article.querySelector('.kommentar-btn').onclick = (e) => {
                e.stopPropagation();
                addKommentar(article);
            };
        }
    </script>
</body>
</html>
